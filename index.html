<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grade Tracker & GPA Calculator</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f5f7fa;
    }
    h2 {
      color: #333;
    }
    input, select, textarea, button {
      margin: 5px;
      padding: 5px;
      font-size: 1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ccc;
      text-align: left;
    }
    th {
      background-color: #e0e0e0;
    }
    #ocrOutput {
      white-space: pre-wrap;
      background: #f0f0f0;
      padding: 10px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h2>Grade Tracker & GPA Calculator</h2>

  <h3>Add Course</h3>
  <input id="semester" placeholder="Semester (e.g. 01, 02)" />
  <input id="courseCode" placeholder="Course Code" />
  <input id="courseName" placeholder="Course Name" />
  <input id="credits" type="number" placeholder="Credits" />
  <select id="grade">
    <option>S</option>
    <option>A</option>
    <option>B</option>
    <option>C</option>
    <option>D</option>
    <option>E</option>
  </select>
  <select id="category">
    <option>Professional</option>
    <option>Science</option>
    <option>Engineering</option>
    <option>Humanities</option>
    <option>Free</option>
  </select>
  <button onclick="addCourse()">Add Course</button>

  <h3>Paste Gradecard</h3>
  <textarea id="gradecardInput" rows="6" cols="80" placeholder="Paste gradecard lines here. First column = Semester"></textarea><br>
  <button onclick="parseGradecard()">Import Courses</button>

  <h3>Or Upload Gradecard Image</h3>
  <input type="file" accept="image/*" onchange="handleImageUpload(event)" />
  <div id="ocrOutput"></div>

  <h3>Courses</h3>
  <table>
    <thead>
      <tr>
        <th>Semester</th>
        <th>Course</th>
        <th>Credits</th>
        <th>Grade</th>
        <th>Point</th>
        <th>Category</th>
      </tr>
    </thead>
    <tbody id="courseTable"></tbody>
  </table>

  <h3>Summary</h3>
  <div id="summary"></div>

<script>
  const gradeMap = { S: 10, A: 9, B: 8, C: 7, D: 6, E: 4 };
  const maxCategoryCredits = {
    Professional: 232,
    Free: 42,
    Science: 102,
    Engineering: 57,
    Humanities: 27
  };
  let courses = [];

  function addCourse() {
    const semester = document.getElementById('semester').value.trim();
    const code = document.getElementById('courseCode').value.trim();
    const name = document.getElementById('courseName').value.trim();
    const credits = parseFloat(document.getElementById('credits').value);
    const grade = document.getElementById('grade').value;
    const category = document.getElementById('category').value;

    if (!semester || !code || !name || !credits || isNaN(credits)) {
      alert('Please fill all fields with valid data.');
      return;
    }

    const point = gradeMap[grade] || 0;
    courses.push({ semester, name: `${code} - ${name}`, credits, grade, point, category });
    render();
  }

  function parseGradecard() {
    const raw = document.getElementById('gradecardInput').value;
    const lines = raw.split('\n');
    const categories = ['Professional', 'Science', 'Engineering', 'Humanities', 'Free'];

    for (const line of lines) {
      const parts = line.trim().split(/\s+/);
      if (parts.length < 6) continue;

      const semester = parts[0];
      const code = parts[1];
      const credits = parseFloat(parts[parts.length - 3]);
      const grade = parts[parts.length - 2];
      const name = parts.slice(2, parts.length - 3).join(' ');

      if (isNaN(credits)) continue;

      const point = gradeMap[grade] || 0;

      // Prompt user for category with default "Professional"
      let category = prompt(`Select category for course:\n${code} - ${name}\nOptions: ${categories.join(', ')}`, 'Professional');
      if (!category || !categories.includes(category.trim())) {
        category = 'Professional';
      } else {
        category = category.trim();
      }

      courses.push({ semester, name: `${code} - ${name}`, credits, grade, point, category });
    }
    render();
  }

  function render() {
    const tbody = document.getElementById('courseTable');
    tbody.innerHTML = '';
    courses.forEach(c => {
      const row = `<tr>
        <td>${c.semester}</td>
        <td>${c.name}</td>
        <td>${c.credits}</td>
        <td>${c.grade}</td>
        <td>${c.point}</td>
        <td>${c.category}</td>
      </tr>`;
      tbody.innerHTML += row;
    });

    let totalCredits = 0, totalPoints = 0;
    let categoryCredits = { Professional: 0, Free: 0, Science: 0, Engineering: 0, Humanities: 0 };

    courses.forEach(c => {
      totalCredits += c.credits;
      totalPoints += c.credits * c.point;
      if (categoryCredits[c.category] !== undefined) {
        categoryCredits[c.category] += c.credits;
      }
    });

    const cgpa = totalCredits > 0 ? (totalPoints / totalCredits).toFixed(2) : "0.00";

    let summary = `<p><b>CGPA:</b> ${cgpa}</p>`;
    for (const cat in categoryCredits) {
      let extra = '';
      const diff = categoryCredits[cat] - maxCategoryCredits[cat];
      if (cat !== 'Free' && diff > 0) {
        categoryCredits['Free'] += diff;
        extra = ` (+${diff.toFixed(1)} shown in Free)`;
      }
      summary += `<p>${cat}: ${categoryCredits[cat].toFixed(1)}${extra}</p>`;
    }
    summary += `<p>Total Credits: ${totalCredits.toFixed(1)}</p>`;
    document.getElementById('summary').innerHTML = summary;
  }

  function handleImageUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    Tesseract.recognize(
      file,
      'eng',
      { logger: m => console.log(m) }
    ).then(({ data: { text } }) => {
      document.getElementById('ocrOutput').innerText = text;
      document.getElementById('gradecardInput').value = text;
      alert('Text extracted from image. Now click "Import Courses".');
    });
  }
</script>
</body>
</html>
